<ng-container *ngIf="post.id">
  <header>
    <h2 class="postTitle">{{ post.title }}</h2>
    <app-badge *ngIf="post.userData" [ngClass]="post.userData.userName.length <= 6 ? 'short' : ''" [link]="post.postedBy" [img]="post.userData.userPhoto">{{ post.userData.userName }}</app-badge>
    <h3 class="timestamp">Posted at: {{ post?.postedAt?.toDate() | date:'medium' }}</h3>
    <div class="buttons" *ngIf="post.postedBy == userUID">
      <button (click)="deletePost()">Delete post</button>
      <button (click)="toggleIsEdit()">Edit post</button>
    </div>
  </header>
  <!-- TODO: Add support for MP4 and WEBM -->
  <app-image [fullimg]="postimage" [thumbnail]="thumbimage" [desc]="post.content" *ngIf="postimage"></app-image>
  <div class="content" [innerHTML]="post.content | markdown" *ngIf="!isEdit"></div>
  <form [formGroup]="postEdit" (ngSubmit)="onSubmitEdit()" *ngIf="isEdit" class="edit-post">
    <app-wysiwyg formControlName="content"></app-wysiwyg>
    <button type="submit">Submit edit</button>
  </form>
  <div class="newReply">
    <button (click)="toggleIsReply()">Reply</button>
    <progress *ngIf="progress" [value]="progress || 0" max="100"></progress>
    <form [formGroup]="reply" (ngSubmit)="onSubmit()" #form *ngIf="isReply">
      <app-wysiwyg formControlName="content"></app-wysiwyg>
      <label>Unsuitable for children <input type="checkbox" formControlName="isNSFW"></label>
      <app-upload formControlName="image"></app-upload>
      <button type="submit">Send</button>
    </form>
  </div>
  <div class="replies">
    <h2>Replies: {{ post.commentCount }}</h2>
    <app-reply *ngFor="let reply of replies | async" [content]="reply"></app-reply>
  </div>
  <div class="error" *ngIf="error">
    <p>{{ error }}</p>
    <button (click)="closeError()">Close</button>
  </div>
</ng-container>
